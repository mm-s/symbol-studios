#!/bin/bash


gitBz="nemtech"
gitCore="symbol-sdk-core-cpp"
gitRpc="symbol-sdk-cpp"
gitSkel="symbol-skel-cpp"

function help {
	echo "$0 commands"
	echo "	bootstrap - Clone here the SDK repositories."
	echo "	sync - call scripts/sync on each project"
}

function sync {
	echo "WARNING. branch marc-os will be pushed for all reps. Ok or CTL-C Abort."
	read yes

	echo "calling sync.sh on rpc"
	pushd rpc > /dev/null
		scripts/sync.sh "marc-os"
		git push
	popd > /dev/null
	echo "calling sync.sh on skel"
	pushd skel > /dev/null
		scripts/sync.sh "marc-os"
		git push
	popd > /dev/null
}

function bootstrap {
	branch=$1
	if [[ "_${branch}" == "_" ]]; then
		branch="marc-os"
	fi
	if [[ -d $gitCore ]]; then
		echo "Error. Workspace is not clean."
		exit 1
	fi
	URL="https://github.com/$gitBz"
	echo "git clone -b ${branch} ${URL}/$gitCore"
	git clone -b ${branch} ${URL}/$gitCore
	git clone -b ${branch} ${URL}/$gitRpc
	git clone -b ${branch} ${URL}/$gitSkel
}

cmd=$1
shift

if [[ "_$cmd" == "_bootstrap" ]]; then
	bootstrap "$@"
	exit 0
fi
if [[ "_$cmd" == "_sync" ]]; then
	sync "$@"
	exit 0
fi

echo "Error: Invalid command"
help
exit 1
